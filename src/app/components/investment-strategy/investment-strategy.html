<div class="strategy-container">
    <div class="header">
        <h1>Strategia Inwestycyjna</h1>
        <p>Zaawansowana symulacja portfela obligacji</p>
    </div>

    <div class="strategy-content">
        <!-- Configuration Control Panel -->
        <div class="controls-panel">
            <h2>Konfiguracja</h2>

            <div class="form-group">
                <label>Częstotliwość (miesiące)</label>
                <input type="number" [ngModel]="frequencyMonths()" (ngModelChange)="updateKwargs('freq', $event)"
                    min="1" max="12">
                <span class="hint">Co ile miesięcy dokupować obligacje</span>
            </div>

            <div class="form-group">
                <label>Czas trwania</label>
                <label>Czas trwania</label>
                <input type="range" [ngModel]="durationMonths()" (ngModelChange)="updateKwargs('dur', $event)" min="1"
                    max="120" step="1" list="strategy-markers">
                <datalist id="strategy-markers">
                    <option value="12" label="1 rok"></option>
                    <option value="24" label="2 lata"></option>
                    <option value="36" label="3 lata"></option>
                    <option value="48" label="4 lata"></option>
                    <option value="60" label="5 lat"></option>
                    <option value="72" label="6 lat"></option>
                    <option value="84" label="7 lat"></option>
                    <option value="96" label="8 lat"></option>
                    <option value="108" label="9 lat"></option>
                    <option value="120" label="10 lat"></option>
                </datalist>
                <span class="value-label">{{ durationMonths() }} mies.</span>
            </div>

            <div class="form-group">
                <label>Inflacja (%)</label>
                <input type="number" [ngModel]="inflationRate()" (ngModelChange)="updateKwargs('infl', $event)" min="0"
                    max="20" step="0.1">
                <span class="hint">Dla obligacji indeksowanych (COI, EDO)</span>
            </div>

            <div class="form-group bond-selection">
                <label>Obligacje i Kwoty</label>
                <div class="radio-list">
                    <div *ngFor="let config of configurations()" class="config-item">
                        <div class="config-header" (click)="toggleBond(config)">
                            <div class="radio-circle checkbox-style">
                                <div class="radio-inner" *ngIf="config.isSelected"></div>
                            </div>
                            <div class="bond-info">
                                <span class="bond-name">{{ config.bond.name }}</span>
                                <span class="bond-desc">{{ config.bond.description }}</span>
                            </div>
                        </div>

                        <!-- Collapsible Inputs -->
                        <div class="config-inputs" *ngIf="config.isSelected">
                            <div class="input-row">
                                <div class="input-wrapper">
                                    <label>Start (zł)</label>
                                    <input type="number" [ngModel]="config.initialAmount"
                                        (ngModelChange)="updateConfigValue(config, 'initialAmount', $event)" min="0"
                                        step="100">
                                </div>
                                <div class="input-wrapper">
                                    <label>Cyklicznie (zł)</label>
                                    <input type="number" [ngModel]="config.recurringAmount"
                                        (ngModelChange)="updateConfigValue(config, 'recurringAmount', $event)" min="0"
                                        step="100">
                                </div>
                            </div>
                            <div class="input-row">
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" [id]="'reinvest-' + config.bond.type"
                                        [ngModel]="config.reinvest"
                                        (ngModelChange)="updateConfigValue(config, 'reinvest', $event)">
                                    <label [for]="'reinvest-' + config.bond.type">Reinwestuj zysk po zakończeniu
                                        obligacji</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart and Summary -->
        <div class="visualization-panel">

            <!-- Summary Stats -->
            <div class="summary-cards" *ngIf="simulation()">
                <div class="summary-card">
                    <span class="label">Wpłacono łącznie</span>
                    <span class="value">{{ totalInvestedSum | number:'1.2-2' }} zł</span>
                </div>
                <div class="summary-card highlight">
                    <span class="label">Wartość portfela</span>
                    <span class="value">{{ totalValueSum | number:'1.2-2' }} zł</span>
                </div>
                <div class="summary-card profit">
                    <span class="label">Zysk Brutto</span>
                    <span class="value">+{{ totalProfit | number:'1.2-2' }} zł</span>
                </div>
                <div class="summary-card net-profit">
                    <span class="label">Zysk Netto</span>
                    <span class="value">+{{ netProfit | number:'1.2-2' }} zł</span>
                </div>
            </div>

            <!-- Summary Chart -->
            <div class="chart-container" *ngIf="summaryChart(); let chart">
                <h3>{{ chart.title }}</h3>
                <div class="canvas-wrapper">
                    <canvas baseChart [data]="chart.data" [options]="chart.options" [type]="lineChartType">
                    </canvas>
                </div>
            </div>

            <!-- Individual Charts Grid -->
            <div class="charts-grid" *ngIf="individualCharts().length > 0">
                <div class="chart-container small" *ngFor="let chart of individualCharts()">
                    <h3>{{ chart.title }}</h3>
                    <div class="canvas-wrapper">
                        <canvas baseChart [data]="chart.data" [options]="chart.options" [type]="lineChartType">
                        </canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>